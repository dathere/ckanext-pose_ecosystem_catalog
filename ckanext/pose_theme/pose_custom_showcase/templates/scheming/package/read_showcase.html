{% extends "page.html" %}

{% set pkg = pkg_dict or c.pkg_dict %}
{% set name = pkg.title or pkg.name %}
{% set editor = h.get_showcase_wysiwyg_editor() %}


{% block subtitle %}{{ pkg.title or pkg.name }} - {{ _('Showcases') }}{% endblock %}

{% block styles %}
  {{ super() }}
  {% set _type = 'asset' if h.ckan_version().split('.')[1] | int >= 9 else 'resource'  %}
  {% snippet 'showcase/snippets/showcase_css_' ~ _type ~ '.html' %}
  {% if editor == 'ckeditor' %}
    {% snippet 'showcase/snippets/ckeditor_content_css_' ~ _type ~ '.html' %}
  {% endif %}
{% endblock %}

{% block links -%}
    {{ super() }}
    
{% endblock -%}

{% block head_extras -%}
    {{ super() }}
    {% set description = h.markdown_extract(pkg.notes, extract_length=200)|forceescape %}
    <meta property="og:title" content="{{ h.dataset_display_name(pkg) }} - {{ g.site_title }}">
    <meta property="og:description" content="{{ description }}">
    <meta property="og:url" content="{{ h.full_current_url() }}">
    {% if pkg.image_display_url %}
        <meta property="og:image" content="{{ pkg.image_display_url }}">
    {% endif %}
{% endblock -%}

{% block breadcrumb_content_selected %} class="active"{% endblock %}

{% block breadcrumb_content %}
    {% set showcase = pkg.title or pkg.name %}
    <li>{{ h.nav_link(_('Showcases'), named_route=pkg.type+'.read', id=pkg.name, package_type=pkg.type) }}</li>
    <li{{ self.breadcrumb_content_selected() }}>{% link_for showcase|truncate(30), named_route=pkg.type+'.edit', id=pkg.name %}</li>
{% endblock %}

{% block page_header %}
{% endblock %}

{% block pre_primary %}
{% endblock %}

{% block primary_content_inner %}
    {% if h.check_access('package_update', {'id':pkg.id }) %}
        <div class="actions">
            {% link_for _('Manage'), named_route=pkg.type+'.edit', id=pkg.name, package_type=pkg.type, class_='btn btn-default', icon='wrench' %}
        </div>
    {% endif %}
    {% block package_description %}
        {% if pkg.private %}
            <span class="dataset-private label label-inverse pull-right">
                <i class="fa fa-lock icon-lock"></i>
                {{ _('Private') }}
            </span>
        {% endif %}
        <h1>
            {% block page_heading %}
                {{ name }}
                {% if pkg.state.startswith('draft') %}
                    [{{ _('Draft') }}]
                {% endif %}
            {% endblock %}
        </h1>
          {% set image_url = h.get_value_from_showcase_extras(pkg.extras, 'image_url') %}
          {% if not image_url %}
            {% set image_url = pkg.resources[0].url if pkg.resources else None %}
          {% endif %}
          <p class="ckanext-showcase-image-container">
            {% if pkg.url %}
            <a class="ckanext-showcase-launch" href="{{pkg.url}}" target="_blank">
              <img src="{{h.url_for_static_or_external(image_url)}}" alt="{{ name }}" class="media-image ckanext-showcase-image img-responsive">
              </a>
            {% else %}
            <img src="{{h.url_for_static_or_external(image_url)}}" alt="{{ name }}" class="media-image ckanext-showcase-image img-responsive">           
             {% endif %}
          </p>
    {% block package_notes %}
      {% if pkg.notes and editor == 'ckeditor' %}
        <div class="ck-content">
          {{ pkg.notes|safe }}
        </div>
      {% elif pkg.notes %}
        <div class="notes embedded-content ckanext-showcase-notes">
          {{ pkg.notes }}
        </div>
      {% endif %}
    {% endblock %}

        {% if pkg.url %}
            <p><a class="btn btn-primary ckanext-showcase-launch" href="{{ pkg.url }}" target="_blank"><i class="fa fa-external-link icon-external-link"></i> {{ _('Visit') }}</a></p>
        {% endif %}

    {% endblock %}

    {% block package_tags %}
        {% snippet "showcase/snippets/tags.html", type=pkg.type, tags=pkg.tags %}
    {% endblock %}

    {% block package_search_results_list %}
    {% endblock %}

{% endblock %}

{% block secondary_content %}
    {% block secondary_help_content %}{% endblock %}

    {% block package_info %}
        {% snippet 'showcase/snippets/showcase_info.html', pkg=pkg %}
    {% endblock %}

    {% block package_social %}
        {% snippet "snippets/social.html" %}
    {% endblock %}
{% endblock %}
